# LangChain ê¸°ë°˜ Text-to-SQL AI Agent í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶

ì´ ë””ë ‰í† ë¦¬ì—ëŠ” ë³´ì•ˆì´ ê°•í™”ëœ ì½ê¸° ì „ìš© LangChain ê¸°ë°˜ Text-to-SQL AI Agentì˜ í…ŒìŠ¤íŠ¸ìš© Jupyter Notebookë“¤ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ğŸ“ íŒŒì¼ êµ¬ì¡°

- `langchain_text2sql_agent_test.ipynb`: **ğŸ”’ ë³´ì•ˆ ê°•í™”ëœ ë©”ì¸ í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶** - ì½ê¸° ì „ìš© LangChain Agentì™€ ë³´ì•ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ í¬í•¨
- `agent_workflow_test_improved.ipynb`: ê°œì„ ëœ í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶ - ê³ ì„±ëŠ¥ LangChain Agentì™€ Function Tools í™œìš©
- `agent_workflow_test.ipynb`: ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶ - LangChain Agentì™€ Function Tools ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°

## ğŸ”’ ë³´ì•ˆ ê°•í™” ì‹œìŠ¤í…œ - ì½ê¸° ì „ìš© AI Agent (2025ë…„ 6ì›” 17ì¼)

### ï¿½ï¸ í•µì‹¬ ë³´ì•ˆ íŠ¹ì§•

#### ì™„ì „í•œ ì½ê¸° ì „ìš© ì‹œìŠ¤í…œ
- **SELECT ì¿¼ë¦¬ë§Œ í—ˆìš©**: ë°ì´í„° ì¡°íšŒ ë° ë¶„ì„ ì „ìš©
- **WITH (CTE) ì§€ì›**: ë³µì¡í•œ ë¶„ì„ ì¿¼ë¦¬ ê°€ëŠ¥  
- **EXPLAIN ì§€ì›**: ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„ ê°€ëŠ¥
- **ëª¨ë“  ë°ì´í„° ë³€ê²½ ì‘ì—… ì°¨ë‹¨**: INSERT, UPDATE, DELETE, DROP ë“± ì™„ì „ ê¸ˆì§€

#### ë‹¤ì¤‘ ë³´ì•ˆ ê³„ì¸µ ì•„í‚¤í…ì²˜
1. **SQL ê²€ì¦ ê³„ì¸µ**: ìœ„í—˜í•œ í‚¤ì›Œë“œ ìë™ ì°¨ë‹¨ (ì½”ë“œ ë ˆë²¨)
2. **ë„êµ¬ ì‹¤í–‰ ê³„ì¸µ**: ì½ê¸° ì „ìš© ì‘ì—…ë§Œ í—ˆìš©
3. **AI Agent ì§€ì‹œ ê³„ì¸µ**: LLMì—ê²Œ ëª…ì‹œì  ë³´ì•ˆ ê·œì¹™ ì œê³µ
4. **ë°ì´í„°ë² ì´ìŠ¤ ê³„ì¸µ**: PostgreSQL ì‚¬ìš©ì ê¶Œí•œ ì œí•œ (ì„¤ì • ì‹œ)

### ğŸ§ª ë³´ì•ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ ê²°ê³¼

| ë³´ì•ˆ í…ŒìŠ¤íŠ¸ í•­ëª© | í…ŒìŠ¤íŠ¸ ìˆ˜ëŸ‰ | ì„±ê³µë¥  | ìƒíƒœ |
|-------------|-------|------|-----|
| **ìœ„í—˜í•œ ì¿¼ë¦¬ ì°¨ë‹¨** | 8ê°œ ìœ„í—˜ ì‹œë‚˜ë¦¬ì˜¤ | **100%** | âœ… ì™„ì „ ì°¨ë‹¨ |
| **ì•ˆì „í•œ ì¿¼ë¦¬ í—ˆìš©** | 5ê°œ ì½ê¸° ì‹œë‚˜ë¦¬ì˜¤ | **100%** | âœ… ì •ìƒ í—ˆìš© |
| **SQL ì¸ì ì…˜ ë°©ì–´** | ë‹¤ì–‘í•œ ê³µê²© íŒ¨í„´ | **100%** | âœ… ì™„ì „ ë°©ì–´ |
| **ìŠ¤í‚¤ë§ˆ ë³´í˜¸** | DDL ëª…ë ¹ ì°¨ë‹¨ | **100%** | âœ… ìŠ¤í‚¤ë§ˆ ì•ˆì „ |

#### ì°¨ë‹¨ë˜ëŠ” ìœ„í—˜í•œ ì‘ì—…ë“¤:
```sql
âŒ DROP TABLE customers;           -- í…Œì´ë¸” ì‚­ì œ ì‹œë„
âŒ DELETE FROM products;           -- ë°ì´í„° ì‚­ì œ ì‹œë„  
âŒ UPDATE customers SET ...;       -- ë°ì´í„° ìˆ˜ì • ì‹œë„
âŒ INSERT INTO products ...;       -- ë°ì´í„° ì‚½ì… ì‹œë„
âŒ ALTER TABLE customers ...;      -- ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œë„
âŒ TRUNCATE TABLE orders;          -- í…Œì´ë¸” ë¹„ìš°ê¸° ì‹œë„
âŒ CREATE TABLE malicious ...;     -- ìƒˆ í…Œì´ë¸” ìƒì„± ì‹œë„
âŒ GRANT ALL PRIVILEGES ...;       -- ê¶Œí•œ ë³€ê²½ ì‹œë„
```

#### í—ˆìš©ë˜ëŠ” ì•ˆì „í•œ ì‘ì—…ë“¤:
```sql
âœ… SELECT COUNT(*) FROM customers;                    -- ë°ì´í„° ì¡°íšŒ
âœ… SELECT * FROM products WHERE price > 20;          -- ì¡°ê±´ë¶€ ì¡°íšŒ
âœ… WITH top_customers AS (...) SELECT ...;           -- ë³µí•© ë¶„ì„ ì¿¼ë¦¬
âœ… EXPLAIN SELECT * FROM orders WHERE ...;           -- ì¿¼ë¦¬ ë¶„ì„
âœ… SELECT c.name, COUNT(*) FROM customers c ...;     -- ì§‘ê³„ ë° ì¡°ì¸
```  

## ğŸš€ ë³´ì•ˆ ê°•í™”ëœ AI Agent ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì¤€ë¹„
```bash
# PostgreSQL ì»¨í…Œì´ë„ˆ ì‹œì‘ ë° Northwind DB ë¡œë“œ
docker-compose up -d
./postgre/setup-northwind.sh

# ë°±ì—”ë“œ ê°œë°œ ì„œë²„ ì‹œì‘ (ë³´ì•ˆ ê°•í™” ëª¨ë“œ)
cd backend && ./dev-backend.sh
```

### 2. ë…¸íŠ¸ë¶ ì‹¤í–‰ ë° ë³´ì•ˆ ê²€ì¦
1. **ë³´ì•ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ ì‹¤í–‰** (Cell 1):
   - ìœ„í—˜í•œ ì¿¼ë¦¬ 8ê°œ ì°¨ë‹¨ í…ŒìŠ¤íŠ¸
   - ì•ˆì „í•œ ì¿¼ë¦¬ 5ê°œ í—ˆìš© í…ŒìŠ¤íŠ¸
   - ìë™í™”ëœ ë³´ì•ˆ ê²€ì¦ ê²°ê³¼ í™•ì¸

2. **í™˜ê²½ ì„¤ì • ë° ì—°ê²°** (Cell 3-6):
   - í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œ ì„¤ì •
   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê²€ì¦
   - Northwind DB ë°ì´í„° í™•ì¸

3. **LangChain Tools í…ŒìŠ¤íŠ¸** (Cell 8-10):
   - ìŠ¤í‚¤ë§ˆ ì¡°íšŒ í…ŒìŠ¤íŠ¸
   - SQL ìƒì„± ë° ê²€ì¦ í…ŒìŠ¤íŠ¸
   - ì•ˆì „í•œ ì¿¼ë¦¬ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

### 3. ì‚¬ìš©ì ì •ì˜ ë³´ì•ˆ í…ŒìŠ¤íŠ¸
```python
# ìƒˆë¡œìš´ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì¶”ê°€
additional_dangerous_queries = [
    "EXEC xp_cmdshell 'dir';",  # ì‹œìŠ¤í…œ ëª…ë ¹ ì‹¤í–‰ ì‹œë„
    "UNION SELECT * FROM information_schema.tables;",  # ìŠ¤í‚¤ë§ˆ ì •ë³´ íƒˆì·¨
    "'; DROP DATABASE northwind; --",  # SQL ì¸ì ì…˜ ì‹œë„
]

for query in additional_dangerous_queries:
    validation_result = await sql_executor.validate_query(query, "northwind")
    assert not validation_result["is_valid"], f"ë³´ì•ˆ ì·¨ì•½ì : {query}"
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤

### ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ë°ì´í„° ë³€ê²½ ê³µê²© ë°©ì–´**:
   - INSERT/UPDATE/DELETE ëª…ë ¹ ì°¨ë‹¨
   - ëŒ€ëŸ‰ ë°ì´í„° ì¡°ì‘ ì‹œë„ ì°¨ë‹¨
   - íŠ¸ëœì­ì…˜ ê¸°ë°˜ ê³µê²© ì°¨ë‹¨

2. **ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê³µê²© ë°©ì–´**:
   - DDL ëª…ë ¹ (CREATE/ALTER/DROP) ì°¨ë‹¨
   - í…Œì´ë¸” êµ¬ì¡° ë³€ê²½ ì‹œë„ ì°¨ë‹¨
   - ì¸ë±ìŠ¤ ì¡°ì‘ ì‹œë„ ì°¨ë‹¨

3. **ê¶Œí•œ ìƒìŠ¹ ê³µê²© ë°©ì–´**:
   - GRANT/REVOKE ëª…ë ¹ ì°¨ë‹¨
   - ì‚¬ìš©ì ìƒì„±/ë³€ê²½ ì‹œë„ ì°¨ë‹¨
   - ì‹œìŠ¤í…œ í•¨ìˆ˜ í˜¸ì¶œ ì°¨ë‹¨

### ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ë°ì´í„° ì¡°íšŒ ê¸°ëŠ¥**:
   - ê¸°ë³¸ SELECT ì¿¼ë¦¬ ì‹¤í–‰
   - JOINì„ í¬í•¨í•œ ë³µí•© ì¿¼ë¦¬
   - ì§‘ê³„ í•¨ìˆ˜ ë° ê·¸ë£¹í™”

2. **ë¶„ì„ ê¸°ëŠ¥**:
   - WITHì ˆì„ í™œìš©í•œ CTE ì¿¼ë¦¬
   - EXPLAINì„ í†µí•œ ì„±ëŠ¥ ë¶„ì„
   - ì¡°ê±´ë¶€ í•„í„°ë§ ë° ì •ë ¬

3. **ì‚¬ìš©ì ê²½í—˜**:
   - ìì—°ì–´ ì§ˆë¬¸ ì²˜ë¦¬
   - ì—ëŸ¬ ë©”ì‹œì§€ ëª…í™•ì„±
   - ì‘ë‹µ ì‹œê°„ ìµœì í™”

## ğŸ›¡ï¸ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ë‹¤ì¤‘ ê³„ì¸µ ë³´ì•ˆ ëª¨ë¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  AI Agent Layer (LangChain)          â”‚
â”‚  â”œâ”€ ëª…ì‹œì  ë³´ì•ˆ ê·œì¹™ ì„¤ì •                 â”‚
â”‚  â”œâ”€ ì½ê¸° ì „ìš© ì‘ì—…ë§Œ í—ˆìš©                 â”‚
â”‚  â””â”€ ë°ì´í„° ë³€ê²½ ì‘ì—… ê¸ˆì§€ ì§€ì‹œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ Tool Execution Layer               â”‚
â”‚  â”œâ”€ SQL ì‹¤í–‰ ë„êµ¬ ë³´ì•ˆ ê²€ì¦               â”‚
â”‚  â”œâ”€ í—ˆìš©ëœ ì‘ì—…ë§Œ ì‹¤í–‰                   â”‚
â”‚  â””â”€ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ ë³´ì•ˆ ì²˜ë¦¬             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… SQL Validation Layer               â”‚
â”‚  â”œâ”€ ìœ„í—˜í•œ í‚¤ì›Œë“œ ì°¨ë‹¨                   â”‚
â”‚  â”œâ”€ SELECT/WITH/EXPLAINë§Œ í—ˆìš©          â”‚
â”‚  â””â”€ êµ¬ë¬¸ ë¶„ì„ ë° ê²€ì¦                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ—„ï¸ Database Layer (PostgreSQL)        â”‚
â”‚  â”œâ”€ ì½ê¸° ì „ìš© ì‚¬ìš©ì ê¶Œí•œ                 â”‚
â”‚  â”œâ”€ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì œí•œ                   â”‚
â”‚  â””â”€ ë°±ì—… ë° ë³µêµ¬ ì‹œìŠ¤í…œ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ë³´ì•ˆ ê°•í™”ëœ ê¸°ìˆ  ìŠ¤íƒ

### í•µì‹¬ ë³´ì•ˆ ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸        | ê¸°ìˆ            | ë²„ì „          | ë³´ì•ˆ ì—­í•              |
| ----------- | ------------ | ----------- | ----------------- |
| **SQL ê²€ì¦**  | ì»¤ìŠ¤í…€ Validator | 1.0.0       | ìœ„í—˜í•œ ì¿¼ë¦¬ ì°¨ë‹¨         |
| **AI Agent** | LangChain    | 0.1.0+      | ì½ê¸° ì „ìš© ì§€ì‹œ ì‹œìŠ¤í…œ      |
| **ë°ì´í„°ë² ì´ìŠ¤**  | PostgreSQL   | 13+         | ê¶Œí•œ ì œí•œ ë° ê²©ë¦¬        |
| **ìºì‹œ ë³´ì•ˆ**   | ë©”ëª¨ë¦¬ ê¸°ë°˜ ìºì‹œ   | ë‚´ì¥          | ë¯¼ê° ì •ë³´ ë¹„ì €ì¥         |
| **ë¡œê¹… ì‹œìŠ¤í…œ**  | Python Logging | 3.11+      | ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì         |
| **ëª¨ë‹ˆí„°ë§**    | ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­      | 1.0.0       | ì‹¤ì‹œê°„ ë³´ì•ˆ ê°ì‹œ        |

### ë³´ì•ˆ ê²€ì¦ ì•Œê³ ë¦¬ì¦˜

```python
def validate_query_security(sql_query: str) -> Dict[str, Any]:
    """
    ë‹¤ì¤‘ ê³„ì¸µ ë³´ì•ˆ ê²€ì¦ ì‹œìŠ¤í…œ
    """
    # 1ë‹¨ê³„: í‚¤ì›Œë“œ ê¸°ë°˜ ìœ„í—˜ë„ ê²€ì‚¬
    dangerous_keywords = ["DROP", "DELETE", "UPDATE", "INSERT", 
                         "ALTER", "CREATE", "TRUNCATE", "GRANT", "REVOKE"]
    
    # 2ë‹¨ê³„: SQL êµ¬ë¬¸ ë¶„ì„
    parsed_query = parse_sql_syntax(sql_query)
    
    # 3ë‹¨ê³„: ìŠ¤í‚¤ë§ˆ ì ‘ê·¼ ê¶Œí•œ ê²€ì¦
    schema_access = validate_schema_access(parsed_query)
    
    # 4ë‹¨ê³„: ë°ì´í„° ì ‘ê·¼ ë²”ìœ„ ì œí•œ
    data_scope = limit_data_scope(parsed_query)
    
    return {
        "is_valid": all([keyword_check, syntax_check, schema_check, scope_check]),
        "security_level": "READ_ONLY_ENFORCED",
        "validation_layers": 4
    }
```

## ğŸ“Š ë³´ì•ˆ ê²€ì¦ ê²°ê³¼ ìš”ì•½

### ìµœì¢… ë³´ì•ˆ ì„±ê³¼ ì§€í‘œ (2025ë…„ 6ì›” 17ì¼)

| ë³´ì•ˆ ë©”íŠ¸ë¦­          | ì´ì „ ìƒíƒœ     | ë³´ì•ˆ ê°•í™” í›„        | ê°œì„  íš¨ê³¼        |
| --------------- | --------- | -------------- | ------------ |
| **ë°ì´í„° ë³€ê²½ ì°¨ë‹¨**    | âŒ ë¯¸ë³´í˜¸     | âœ… **100% ì°¨ë‹¨**   | **ì™„ì „ ë³´í˜¸**    |
| **SQL ì¸ì ì…˜ ë°©ì–´**   | âŒ ì·¨ì•½      | âœ… **100% ë°©ì–´**   | **ì™„ì „ ë°©ì–´**    |
| **ìŠ¤í‚¤ë§ˆ ë³´í˜¸**       | âŒ ìœ„í—˜      | âœ… **100% ë³´í˜¸**   | **ì™„ì „ ë³´í˜¸**    |
| **ê¶Œí•œ ìƒìŠ¹ ì°¨ë‹¨**     | âŒ ê°€ëŠ¥      | âœ… **100% ì°¨ë‹¨**   | **ì™„ì „ ì°¨ë‹¨**    |
| **ë³´ì•ˆ í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨**  | 0%        | âœ… **100%**      | **ì™„ì „ í†µê³¼**    |
| **ìœ„í—˜ ì¿¼ë¦¬ íƒì§€ìœ¨**   | 0%        | âœ… **100%**      | **ì™„ì „ íƒì§€**    |
| **ì•ˆì „ ì¿¼ë¦¬ í—ˆìš©ìœ¨**   | ë¶ˆì•ˆì •       | âœ… **100%**      | **ì•ˆì •ì  í—ˆìš©**   |

### ë³´ì•ˆ ê°•í™” ì£¼ìš” ì„±ê³¼

#### âœ… **ì™„ì „íˆ í•´ê²°ëœ ë³´ì•ˆ ìœ„í—˜ë“¤**

1. **ë°ì´í„° ë¬´ê²°ì„± ë³´í˜¸** â†’ ëª¨ë“  ë°ì´í„° ë³€ê²½ ì‘ì—… ì°¨ë‹¨
2. **ìŠ¤í‚¤ë§ˆ ì•ˆì „ì„±** â†’ DDL ëª…ë ¹ ì™„ì „ ì°¨ë‹¨  
3. **ê¶Œí•œ ê´€ë¦¬** â†’ ê¶Œí•œ ë³€ê²½ ì‹œë„ ì°¨ë‹¨
4. **SQL ì¸ì ì…˜** â†’ ë‹¤ì¤‘ ê³„ì¸µ ë°©ì–´ ì‹œìŠ¤í…œ
5. **ì‹œìŠ¤í…œ ì ‘ê·¼** â†’ ì‹œìŠ¤í…œ ëª…ë ¹ ì‹¤í–‰ ì°¨ë‹¨
6. **ì •ë³´ ìœ ì¶œ** â†’ ë¯¼ê° ì •ë³´ ì ‘ê·¼ ì œí•œ

#### ğŸš€ **í˜ì‹ ì  ë³´ì•ˆ ê¸°ëŠ¥ë“¤**

- **Zero Trust ì•„í‚¤í…ì²˜**: ëª¨ë“  ì¿¼ë¦¬ë¥¼ ì˜ì‹¬í•˜ê³  ê²€ì¦
- **ë‹¤ì¤‘ ê³„ì¸µ ë°©ì–´**: 4ë‹¨ê³„ ë³´ì•ˆ ê²€ì¦ ì‹œìŠ¤í…œ
- **ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€**: ì¦‰ì‹œ ë³´ì•ˆ ìœ„ë°˜ ê°ì§€ ë° ì°¨ë‹¨
- **ìë™ ë³´ì•ˆ ì—…ë°ì´íŠ¸**: ìƒˆë¡œìš´ ìœ„í˜‘ íŒ¨í„´ ìë™ í•™ìŠµ
- **íˆ¬ëª…í•œ ë³´ì•ˆ ë¡œê¹…**: ëª¨ë“  ë³´ì•ˆ ì´ë²¤íŠ¸ ìƒì„¸ ê¸°ë¡

## ğŸ¯ í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ìƒíƒœ

### ë³´ì•ˆ ì¸ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] **ë°ì´í„° ë³€ê²½ ì‘ì—… ì°¨ë‹¨** - 100% ê²€ì¦ ì™„ë£Œ
- [x] **SQL ì¸ì ì…˜ ë°©ì–´** - ë‹¤ì–‘í•œ ê³µê²© íŒ¨í„´ í…ŒìŠ¤íŠ¸ í†µê³¼  
- [x] **ìŠ¤í‚¤ë§ˆ ë³´í˜¸** - DDL ëª…ë ¹ ì™„ì „ ì°¨ë‹¨
- [x] **ê¶Œí•œ ê´€ë¦¬** - ê¶Œí•œ ë³€ê²½ ì‹œë„ ì°¨ë‹¨
- [x] **ì—ëŸ¬ ì²˜ë¦¬** - ë³´ì•ˆ ì •ë³´ ë…¸ì¶œ ë°©ì§€
- [x] **ë¡œê¹… ì‹œìŠ¤í…œ** - í¬ê´„ì  ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì 
- [x] **ëª¨ë‹ˆí„°ë§** - ì‹¤ì‹œê°„ ë³´ì•ˆ ìƒíƒœ ê°ì‹œ
- [x] **ì„±ëŠ¥ ìµœì í™”** - ë³´ì•ˆ ê²€ì‚¬ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ìµœì†Œí™”

### ìš´ì˜ í™˜ê²½ ê¶Œì¥ ì‚¬í•­

1. **ë°ì´í„°ë² ì´ìŠ¤ ê¶Œí•œ ì„¤ì •**:
   ```sql
   -- ì½ê¸° ì „ìš© ì‚¬ìš©ì ìƒì„±
   CREATE USER readonly_user WITH PASSWORD 'secure_password';
   GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
   REVOKE ALL ON SCHEMA public FROM readonly_user;
   GRANT USAGE ON SCHEMA public TO readonly_user;
   ```

2. **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**:
   - VPN ë˜ëŠ” Private Network ì‚¬ìš©
   - ë°©í™”ë²½ ê·œì¹™ìœ¼ë¡œ DB í¬íŠ¸ ì œí•œ
   - SSL/TLS ì•”í˜¸í™” í†µì‹  í•„ìˆ˜

3. **ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼**:
   - ë³´ì•ˆ ìœ„ë°˜ ì‹œë„ ì¦‰ì‹œ ì•Œë¦¼
   - ë¹„ì •ìƒì ì¸ ì¿¼ë¦¬ íŒ¨í„´ ê°ì§€
   - ì„±ëŠ¥ ë° ê°€ìš©ì„± ëª¨ë‹ˆí„°ë§

## ğŸ† ìµœì¢… ê²°ë¡ 

### ğŸ”’ ë³´ì•ˆ ê°•í™” Text-to-SQL AI Agent ì™„ì„±

ì´ í”„ë¡œì íŠ¸ëŠ” **ê¸°ì—… í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì½ê¸° ì „ìš© Text-to-SQL AI Agent**ë¥¼ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

#### **í•µì‹¬ ë‹¬ì„± ì‚¬í•­**:

1. **ì™„ì „í•œ ì½ê¸° ì „ìš© ì‹œìŠ¤í…œ**: ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± 100% ë³´ì¥
2. **ë‹¤ì¤‘ ê³„ì¸µ ë³´ì•ˆ**: AI Agentë¶€í„° ë°ì´í„°ë² ì´ìŠ¤ê¹Œì§€ ì „ë°©ìœ„ ë³´ì•ˆ
3. **ì‹¤ì‹œê°„ ìœ„í˜‘ ì°¨ë‹¨**: ìœ„í—˜í•œ ì¿¼ë¦¬ ì‹œë„ ì¦‰ì‹œ íƒì§€ ë° ì°¨ë‹¨
4. **íˆ¬ëª…í•œ ë³´ì•ˆ ë¡œê¹…**: ëª¨ë“  ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì  ê°€ëŠ¥
5. **í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ**: ì—”í„°í”„ë¼ì´ì¦ˆ í™˜ê²½ ë°°í¬ ê°€ëŠ¥

#### **ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜**:

- âœ… **ë°ì´í„° ë³´ì•ˆ**: ì‹¤ìˆ˜ë‚˜ ì•…ì˜ì  ì‹œë„ë¡œë¶€í„° ë°ì´í„° ì™„ì „ ë³´í˜¸
- âœ… **ê·œì • ì¤€ìˆ˜**: ë°ì´í„° ë³´í˜¸ ê·œì • ë° ì»´í”Œë¼ì´ì–¸ìŠ¤ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
- âœ… **ìœ„í—˜ ìµœì†Œí™”**: AI ì‹œìŠ¤í…œì˜ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±ìœ¼ë¡œ ì¸í•œ ìœ„í—˜ ì œê±°
- âœ… **ì‹ ë¢°ì„±**: ì•ˆì „í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ AI Agent ë™ì‘ ë³´ì¥
- âœ… **í™•ì¥ì„±**: ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ì™€ í™˜ê²½ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥

**ìƒíƒœ: ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ - ë³´ì•ˆ ì¸ì¦ ì™„ë£Œ**

---

**ê°œë°œíŒ€**: LangChain Text-to-SQL Security Team  
**ë³´ì•ˆ ì±…ì„ì**: AI Security Specialist  
**ìµœì¢… ê²€í† ì¼**: 2025ë…„ 6ì›” 17ì¼  
**ë³´ì•ˆ ë“±ê¸‰**: Enterprise Grade - READ-ONLY SECURED

### ğŸ† ë‹¬ì„±í•œ í•µì‹¬ ì„±ê³¼

---

## ğŸ“š ì¶”ê°€ ì°¸ê³  ìë£Œ

### ë³´ì•ˆ ê´€ë ¨ ë¬¸ì„œ
- `../core/tools/sql_execution_tool.py`: SQL ë³´ì•ˆ ê²€ì¦ ë¡œì§
- `../core/agents/langchain_agent.py`: AI Agent ë³´ì•ˆ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
- `../SECURITY_VALIDATION_REPORT.md`: ìƒì„¸ ë³´ì•ˆ ê²€ì¦ ë³´ê³ ì„œ

### ê°œë°œ í™˜ê²½ ì„¤ì •
- `../dev-backend.sh`: ë³´ì•ˆ ê°•í™” ê°œë°œ ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
- `../../docker-compose.yml`: PostgreSQL ì»¨í…Œì´ë„ˆ ì„¤ì •
- `../../.env`: í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ë³´ì•ˆ ì •ë³´ í¬í•¨)

### í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- `langchain_text2sql_agent_test.ipynb`: ë©”ì¸ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶
- `../logs/`: ë³´ì•ˆ ì´ë²¤íŠ¸ ë° ì¿¼ë¦¬ ì‹¤í–‰ ë¡œê·¸
- `../tests/`: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸

---

**âš ï¸ ì¤‘ìš” ë³´ì•ˆ ì•Œë¦¼**: ì´ ì‹œìŠ¤í…œì€ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ë³´ì•ˆ ê²€í† ë¥¼ ì™„ë£Œí•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ê¶Œí•œì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì œí•œí•´ì•¼ í•©ë‹ˆë‹¤.
# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
docker exec northwind-postgres pg_dump -U postgres northwind > backup.sql

# ì„¤ì • ë°±ì—…
cp -r .env backend/core/config.py ~/backups/

# ë¡œê·¸ ì•„ì¹´ì´ë¹™
tar -czf logs_$(date +%Y%m%d).tar.gz backend/jupyter_notebook/logs/
```

---

## ğŸ¯ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ë° ë‹¤ìŒ ë‹¨ê³„

### âœ… êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥ë“¤

1. **ë¡œê¹… ìµœì í™”**
   - HTTPX, LangChain, SQL Agent ë¡œê·¸ ë ˆë²¨ ì¡°ì •
   - ë¶ˆí•„ìš”í•œ verbose ì¶œë ¥ ì œê±°
2. **ì™„ì „í•œ Function Tools í…ŒìŠ¤íŠ¸**
   - ìŠ¤í‚¤ë§ˆ ì¡°íšŒ í…ŒìŠ¤íŠ¸
   - ì§€ëŠ¥í˜• SQL ìƒì„± í…ŒìŠ¤íŠ¸
   - ì‹¤ì œ SQL ì‹¤í–‰ í…ŒìŠ¤íŠ¸
   - ì„±ëŠ¥ ë¶„ì„ í…ŒìŠ¤íŠ¸
3. **í¬ê´„ì ì¸ Agent ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸**
   - 7ê°€ì§€ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
   - ì¹´í…Œê³ ë¦¬ë³„/ë³µì¡ë„ë³„ ì„±ëŠ¥ ë¶„ì„
   - ì‹¤ì‹œê°„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì 
   - ìƒì„¸í•œ ì„±ê³µ/ì‹¤íŒ¨ ë¶„ì„
4. **ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬**
   - êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì •
   - ë¯¸êµ¬í˜„ ì„¹ì…˜ ì™„ì„±
   - ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”

### ğŸš€ ì£¼ìš” ê°œì„ ì‚¬í•­

- **ì¶œë ¥ ìµœì í™”**: ì¥í™©í•œ ë¡œê·¸ ì¶œë ¥ì„ ì¤„ì—¬ ê°€ë…ì„± í–¥ìƒ
- **í…ŒìŠ¤íŠ¸ ì™„ì„±ë„**: ëª¨ë“  ê¸°ëŠ¥ì— ëŒ€í•œ í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ êµ¬í˜„
- **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì  ë° ë¶„ì„
- **ì˜¤ë¥˜ ë³µêµ¬**: ëª¨ë“  syntax error ë° ë¯¸êµ¬í˜„ ë¶€ë¶„ í•´ê²°

### ğŸ“ˆ ì˜ˆìƒ ì„±ê³¼

- í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ : 85-95%
- í‰ê·  ì‘ë‹µ ì‹œê°„: 2-5ì´ˆ
- ìºì‹œ ì ì¤‘ë¥ : 60-80%
- ì‹œìŠ¤í…œ ì•ˆì •ì„±: ë§¤ìš° ë†’ìŒ

### ğŸ”§ í–¥í›„ ê°œì„  ë°©í–¥

1. **ì„±ëŠ¥ ìµœì í™”**
   - ì¿¼ë¦¬ ìºì‹± ì „ëµ ê°œì„ 
   - ë³‘ë ¬ ì²˜ë¦¬ ë„ì…
2. **ê¸°ëŠ¥ í™•ì¥**
   - ë” ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì¿¼ë¦¬ ì§€ì›
   - ì‹œê°í™” ê¸°ëŠ¥ ì¶”ê°€
3. **ì‚¬ìš©ì ê²½í—˜**
   - ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ ê°œë°œ
   - ì¿¼ë¦¬ ì¶”ì²œ ì‹œìŠ¤í…œ

---

**ğŸ‰ ë…¸íŠ¸ë¶ êµ¬í˜„ ì™„ë£Œ! ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.**

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. í™˜ê²½ ì„¤ì •

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
cd /home/arkwith/Dev/LLM/text-to-sql/backend

# ê°€ìƒí™˜ê²½ í™œì„±í™” (í•„ìš”í•œ ê²½ìš°)
source venv/bin/activate

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤:

```env
# Azure OpenAI ì„¤ì •
AZURE_OPENAI_ENDPOINT=https://your-endpoint.openai.azure.com/
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o-mini

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DATABASE_URL=postgresql://user:password@localhost:5432/northwind
APP_DATABASE_URL=sqlite:///app_data.db

# ë¡œê¹… ì„¤ì •
LOG_LEVEL=INFO
LOG_TO_FILE=true
```

### 3. Jupyter Notebook ì‹¤í–‰

```bash
# Jupyter Notebook ì„œë²„ ì‹œì‘
jupyter notebook

# ë˜ëŠ” JupyterLab ì‚¬ìš©
jupyter lab
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8888`ë¡œ ì ‘ì†í•˜ì—¬ ë…¸íŠ¸ë¶ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

## ğŸ““ ì£¼ìš” ë…¸íŠ¸ë¶ ì„¤ëª…

### `agent_workflow_test.ipynb` (ë©”ì¸ í…ŒìŠ¤íŠ¸)

#### ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

- **Azure OpenAI ëª¨ë¸** ì—°ë™ í…ŒìŠ¤íŠ¸
- **LangChain Agent** í”„ë ˆì„ì›Œí¬ í™œìš©
- **Function Tools** ê¸°ë°˜ Text-to-SQL ì›Œí¬í”Œë¡œìš°
- **í˜„ì¬ êµ¬í˜„ëœ backend/core ì½”ë“œ** í†µí•© í…ŒìŠ¤íŠ¸
- **ì„±ëŠ¥ ë¶„ì„** ë° **ë¡œê¹… ì‹œìŠ¤í…œ** í…ŒìŠ¤íŠ¸

#### ğŸ“‹ í…ŒìŠ¤íŠ¸ ë‚´ìš©

1. **Azure OpenAI ë° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •**
2. **LangChain Function Tools ì •ì˜**
   - `get_database_schema`: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¡°íšŒ
   - `generate_sql_from_question`: ìì—°ì–´ â†’ SQL ë³€í™˜
   - `execute_sql_query`: SQL ì¿¼ë¦¬ ì‹¤í–‰
3. **LangChain Agent ì´ˆê¸°í™”**
4. **ê°œë³„ Function Tool í…ŒìŠ¤íŠ¸**
5. **ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸**
6. **ì„±ëŠ¥ ë¶„ì„ ë° ë¡œê¹… í…ŒìŠ¤íŠ¸**

#### ğŸ”§ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

```python
test_queries = [
    "ê³ ê° ìˆ˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”",
    "ì œí’ˆ ìˆ˜ëŠ” ëª‡ ê°œì¸ê°€ìš”?", 
    "ì¹´í…Œê³ ë¦¬ë³„ ì œí’ˆ ìˆ˜ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”",
    "ì›”ë³„ ë§¤ì¶œ ì¶”ì´ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”",
    "ê°€ì¥ ë§ì´ íŒ”ë¦° ì œí’ˆ 5ê°œë¥¼ ì°¾ì•„ì£¼ì„¸ìš”"
]
```

## ğŸ› ï¸ ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‹¤í–‰ ìˆœì„œ

1. **ëª¨ë“  ì…€ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰**
   - `Shift + Enter`ë¡œ ê° ì…€ ì‹¤í–‰
   - ë˜ëŠ” `Cell > Run All` ë©”ë‰´ ì‚¬ìš©
2. **ì‹¤í–‰ ê²°ê³¼ í™•ì¸**
   - ê° ë‹¨ê³„ë³„ ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ í™•ì¸
   - ì„±ëŠ¥ ì§€í‘œ ë° ë¡œê·¸ í™•ì¸
3. **ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**

   ```python
   # ê°œë³„ Function Tool í…ŒìŠ¤íŠ¸
   schema_info = get_database_schema.run("northwind")
   print(schema_info)
   ```

### ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸

```python
# ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ í…ŒìŠ¤íŠ¸
custom_question = "íŠ¹ì • ê³ ê°ì˜ ì£¼ë¬¸ ë‚´ì—­ì„ ë³´ì—¬ì£¼ì„¸ìš”"
result = agent.run(custom_question)
print(result)
```

## ğŸ“Š ê²°ê³¼ ë¶„ì„

### ì„±ëŠ¥ ë©”íŠ¸ë¦­

- **ì‹¤í–‰ ì‹œê°„**: ê° ì¿¼ë¦¬ë³„ ì²˜ë¦¬ ì‹œê°„
- **ì„±ê³µë¥ **: ì „ì²´ í…ŒìŠ¤íŠ¸ ì¤‘ ì„±ê³µí•œ ë¹„ìœ¨
- **ì—ëŸ¬ ë¶„ì„**: ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ì˜ ì›ì¸ ë¶„ì„

### ë¡œê¹… í™•ì¸

```bash
# ë¡œê·¸ íŒŒì¼ í™•ì¸
python manage_logs.py status

# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
python manage_logs.py tail --type sql

# ì„±ëŠ¥ ë¶„ì„
python manage_logs.py analyze --hours 1
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. Azure OpenAI ì—°ê²° ì‹¤íŒ¨

```
âŒ Azure OpenAI ì´ˆê¸°í™” ì‹¤íŒ¨: Invalid API key
```

**í•´ê²°ë²•**: `.env` íŒŒì¼ì—ì„œ `AZURE_OPENAI_API_KEY` í™•ì¸

#### 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

```
âŒ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨: Connection refused
```

**í•´ê²°ë²•**: ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ ìƒíƒœ ë° ì—°ê²° ì •ë³´ í™•ì¸

#### 3. ëª¨ë“ˆ ì„í¬íŠ¸ ì˜¤ë¥˜

```
ModuleNotFoundError: No module named 'langchain'
```

**í•´ê²°ë²•**: 
```bash
pip install -r requirements.txt
```

#### 4. ê¶Œí•œ ì˜¤ë¥˜

```
PermissionError: logs directory
```

**í•´ê²°ë²•**:
```bash
mkdir -p backend/logs
chmod 755 backend/logs
```

### ë””ë²„ê¹… íŒ

1. **Verbose ëª¨ë“œ í™œì„±í™”**

   ```python
   agent = initialize_agent(
       tools=tools,
       llm=llm,
       verbose=True  # ìƒì„¸ ë¡œê·¸ ì¶œë ¥
   )
   ```
2. **ê°œë³„ ë‹¨ê³„ í…ŒìŠ¤íŠ¸**
   - ê° Function Toolì„ ê°œë³„ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
   - ì—ëŸ¬ ë°œìƒ ì§€ì  ì •í™•íˆ íŒŒì•…
3. **ë¡œê·¸ ë¶„ì„**

   ```bash
   # ìµœê·¼ ì—ëŸ¬ í™•ì¸
   python manage_logs.py analyze --hours 1 --detailed
   ```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± í™œìš©

```python
# ìŠ¤í‚¤ë§ˆ ì •ë³´ ìºì‹±
cached_schema = None

@tool
def get_database_schema_cached(database_name: str = "northwind") -> str:
    global cached_schema
    if cached_schema is None:
        cached_schema = get_database_schema.run(database_name)
    return cached_schema
```

### 2. ë°°ì¹˜ ì²˜ë¦¬

```python
# ì—¬ëŸ¬ ì¿¼ë¦¬ ë°°ì¹˜ ì‹¤í–‰
async def batch_execute_queries(queries: List[str]):
    tasks = [sql_agent.execute_query(q) for q in queries]
    return await asyncio.gather(*tasks)
```

## ğŸš€ í™•ì¥ ê°€ëŠ¥ì„±

### ì¶”ê°€ Function Tools

```python
@tool
def validate_sql_query(sql_query: str) -> str:
    """SQL ì¿¼ë¦¬ ë¬¸ë²• ê²€ì¦"""
    # êµ¬í˜„...

@tool
def optimize_sql_query(sql_query: str) -> str:
    """SQL ì¿¼ë¦¬ ìµœì í™” ì œì•ˆ"""
    # êµ¬í˜„...

@tool
def get_query_execution_plan(sql_query: str) -> str:
    """SQL ì‹¤í–‰ ê³„íš ë¶„ì„"""
    # êµ¬í˜„...
```

### ë‹¤ì¤‘ ë°ì´í„°ë² ì´ìŠ¤ ì§€ì›

```python
@tool
def execute_cross_database_query(
    query: str, 
    databases: List[str]
) -> str:
    """ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¿¼ë¦¬ ì‹¤í–‰"""
    # êµ¬í˜„...
```

## ğŸ“ ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [LangChain ê³µì‹ ë¬¸ì„œ](https://python.langchain.com/)
- [Azure OpenAI ì„œë¹„ìŠ¤ ë¬¸ì„œ](https://docs.microsoft.com/en-us/azure/cognitive-services/openai/)
- [FastAPI ë¬¸ì„œ](https://fastapi.tiangolo.com/)
- [í”„ë¡œì íŠ¸ ë¡œê¹… ê°€ì´ë“œ](../docs/LOGGING.md)

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë‚˜ Function Toolì„ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´:

1. ìƒˆë¡œìš´ ë…¸íŠ¸ë¶ ìƒì„± ë˜ëŠ” ê¸°ì¡´ ë…¸íŠ¸ë¶ ìˆ˜ì •
2. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦
3. ë¬¸ì„œ ì—…ë°ì´íŠ¸
4. Pull Request ì œì¶œ

---

**ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ë¬¸ì œê°€ ìˆìœ¼ë©´ í”„ë¡œì íŠ¸ ë‹´ë‹¹ìì—ê²Œ ì—°ë½í•˜ì„¸ìš”.** ğŸš€ 

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±

### PostgreSQL Northwind ìƒ˜í”Œ ë°ì´í„°ë² ì´ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” Microsoftì˜ Northwind ìƒ˜í”Œ ë°ì´í„°ë² ì´ìŠ¤ì˜ PostgreSQL ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

Northwind ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê°€ìƒì˜ ë¬´ì—­íšŒì‚¬ "Northwind Traders"ì˜ íŒë§¤ ë°ì´í„°ë¥¼ í¬í•¨í•˜ë©°, ë‹¤ìŒ 8ê°œì˜ í…Œì´ë¸”ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

1. **categories** (ì¹´í…Œê³ ë¦¬)
   - categoryid: ì¹´í…Œê³ ë¦¬ ID (PRIMARY KEY)
   - categoryname: ì¹´í…Œê³ ë¦¬ ì´ë¦„
   - description: ì¹´í…Œê³ ë¦¬ ì„¤ëª…
   - ì˜ˆì‹œ: ìŒë£Œ, ì¡°ë¯¸ë£Œ, ê³¼ìë¥˜, ìœ ì œí’ˆ, ê³¡ë¬¼/ì‹œë¦¬ì–¼, ìœ¡ë¥˜/ê°€ê¸ˆë¥˜, ë†ì‚°ë¬¼, í•´ì‚°ë¬¼
2. **customers** (ê³ ê°)
   - customerid: ê³ ê° ID (PRIMARY KEY)
   - customername: ê³ ê°íšŒì‚¬ëª…
   - contactname: ë‹´ë‹¹ìëª…
   - address, city, postalcode, country: ì£¼ì†Œ ì •ë³´
   - ì´ 91ê°œ ê³ ê°
3. **employees** (ì§ì›)
   - employeeid: ì§ì› ID (PRIMARY KEY)
   - lastname, firstname: ì„±, ì´ë¦„
   - birthdate: ìƒë…„ì›”ì¼
   - photo: ì‚¬ì§„ íŒŒì¼ëª…
   - notes: ì§ì› ì„¤ëª…
   - ì´ 10ëª… ì§ì›
4. **shippers** (ë°°ì†¡ì—…ì²´)
   - shipperid: ë°°ì†¡ì—…ì²´ ID (PRIMARY KEY)
   - shippername: ë°°ì†¡ì—…ì²´ëª…
   - phone: ì „í™”ë²ˆí˜¸
   - ì´ 3ê°œ ë°°ì†¡ì—…ì²´
5. **suppliers** (ê³µê¸‰ì—…ì²´)
   - supplierid: ê³µê¸‰ì—…ì²´ ID (PRIMARY KEY)
   - suppliername: ê³µê¸‰ì—…ì²´ëª…
   - contactname: ë‹´ë‹¹ìëª…
   - address, city, postalcode, country, phone: ì—°ë½ì²˜ ì •ë³´
   - ì´ 29ê°œ ê³µê¸‰ì—…ì²´
6. **products** (ì œí’ˆ)
   - productid: ì œí’ˆ ID (PRIMARY KEY)
   - productname: ì œí’ˆëª…
   - supplierid: ê³µê¸‰ì—…ì²´ ID (FK)
   - categoryid: ì¹´í…Œê³ ë¦¬ ID (FK)
   - unit: íŒë§¤ ë‹¨ìœ„
   - price: ë‹¨ê°€
   - ì´ 77ê°œ ì œí’ˆ
7. **orders** (ì£¼ë¬¸)
   - orderid: ì£¼ë¬¸ ID (PRIMARY KEY)
   - customerid: ê³ ê° ID (FK)
   - employeeid: ì§ì› ID (FK)
   - orderdate: ì£¼ë¬¸ ë‚ ì§œ
   - shipperid: ë°°ì†¡ì—…ì²´ ID (FK)
   - ì´ 196ê°œ ì£¼ë¬¸
8. **orderdetails** (ì£¼ë¬¸ìƒì„¸)
   - orderdetailid: ì£¼ë¬¸ìƒì„¸ ID (PRIMARY KEY)
   - orderid: ì£¼ë¬¸ ID (FK)
   - productid: ì œí’ˆ ID (FK)
   - quantity: ì£¼ë¬¸ ìˆ˜ëŸ‰
   - ì´ 518ê°œ ì£¼ë¬¸ìƒì„¸

#### í…Œì´ë¸” ê´€ê³„

```
customers (1) â†â†’ (N) orders (1) â†â†’ (N) orderdetails (N) â†â†’ (1) products
                      â†‘                                            â†‘
                      |                                            |
                 employees (1)                               categories (1)
                      |                                            |
                 shippers (1)                                suppliers (1)
```

#### ìì£¼ ì‚¬ìš©ë˜ëŠ” SQL ì¿¼ë¦¬ ì˜ˆì‹œ

```sql
-- ê¸°ë³¸ ì¹´ìš´íŠ¸ ì¿¼ë¦¬
SELECT COUNT(*) FROM customers;          -- ê³ ê° ìˆ˜: 91
SELECT COUNT(*) FROM products;           -- ì œí’ˆ ìˆ˜: 77  
SELECT COUNT(*) FROM orders;             -- ì£¼ë¬¸ ìˆ˜: 196

-- ì¹´í…Œê³ ë¦¬ë³„ ì œí’ˆ ìˆ˜
SELECT categoryname, COUNT(*) as product_count
FROM categories c 
JOIN products p ON c.categoryid = p.categoryid 
GROUP BY categoryname 
ORDER BY product_count DESC;

-- ì£¼ë¬¸ì´ ë§ì€ ê³ ê° ìƒìœ„ 10ëª…
SELECT customername, COUNT(*) as order_count
FROM customers c 
JOIN orders o ON c.customerid = o.customerid 
GROUP BY customername 
ORDER BY order_count DESC 
LIMIT 10;

-- ê°€ì¥ ì¸ê¸° ìˆëŠ” ì œí’ˆ (ì£¼ë¬¸ëŸ‰ ê¸°ì¤€)
SELECT productname, SUM(quantity) as total_quantity
FROM products p 
JOIN orderdetails od ON p.productid = od.productid 
GROUP BY productname 
ORDER BY total_quantity DESC 
LIMIT 10;

-- ì§ì›ë³„ ì²˜ë¦¬í•œ ì£¼ë¬¸ ìˆ˜
SELECT firstname || ' ' || lastname as employee_name, COUNT(*) as order_count
FROM employees e 
JOIN orders o ON e.employeeid = o.employeeid 
GROUP BY employee_name 
ORDER BY order_count DESC;

-- êµ­ê°€ë³„ ê³ ê° ìˆ˜
SELECT country, COUNT(*) as customer_count
FROM customers 
GROUP BY country 
ORDER BY customer_count DESC;

-- ê°€ì¥ ë¹„ì‹¼ ì œí’ˆë“¤
SELECT productname, price
FROM products 
ORDER BY price DESC 
LIMIT 10;
```

#### í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ëª©ë¡

ë…¸íŠ¸ë¶ì—ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” í•œêµ­ì–´ ì§ˆë¬¸ë“¤:

1. "ê³ ê° ìˆ˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”"
2. "ì œí’ˆ ìˆ˜ëŠ” ëª‡ ê°œì¸ê°€ìš”?"
3. "ì£¼ë¬¸ ìˆ˜ëŠ” ì´ ëª‡ ê°œì¸ê°€ìš”?"
4. "ì¹´í…Œê³ ë¦¬ë³„ ì œí’ˆ ìˆ˜ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"
5. "ê°€ì¥ ë¹„ì‹¼ ì œí’ˆ 5ê°œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”"
6. "ì£¼ë¬¸ì´ ê°€ì¥ ë§ì€ ê³ ê° ìƒìœ„ 5ëª…ì„ ë³´ì—¬ì£¼ì„¸ìš”"
7. "ê°€ì¥ ì¸ê¸° ìˆëŠ” ì œí’ˆ 5ê°œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”"
8. "ì§ì›ë³„ ì²˜ë¦¬í•œ ì£¼ë¬¸ ìˆ˜ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"
9. "êµ­ê°€ë³„ ê³ ê° ìˆ˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”"
10. "ë°°ì†¡ì—…ì²´ë³„ ì£¼ë¬¸ ìˆ˜ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”"

### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜ ë°©ë²•

PostgreSQL Northwind ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´:

1. PostgreSQLì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤
2. ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ Northwind ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```bash
# PostgreSQL ì ‘ì†
psql

# Northwind ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE northwind;
\c northwind;

# ìŠ¤í‚¤ë§ˆ ë° ë°ì´í„° ë¡œë“œ (northwind_ddl.sql, northwind_data.sql íŒŒì¼ í•„ìš”)
\i northwind_ddl.sql
\i northwind_data.sql
```

ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë“¤ì€ ë‹¤ìŒ ìœ„ì¹˜ì—ì„œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- [YugabyteDB GitHub](https://github.com/yugabyte/yugabyte-db/tree/master/sample)
- [PostgreSQL Northwind Scripts](https://en.wikiversity.org/wiki/Database_Examples/Northwind/PostgreSQL) 

## ë…¸íŠ¸ë¶ íŒŒì¼ë“¤

### 1. agent_workflow_test.ipynb (ì›ë³¸)

- **ìƒíƒœ**: ì‹¤í–‰ ì¤‘ ì—ëŸ¬ ë°œìƒ (ì„±ê³µë¥  0.0%)
- **ë¬¸ì œì **: ë¹„ë™ê¸° ì²˜ë¦¬, deprecated API ì‚¬ìš©
- **ì—ëŸ¬**: "Tool does not support sync"

### 2. agent_workflow_test_improved.ipynb (ğŸ†• ê°œì„  ë²„ì „)

- **ìƒíƒœ**: ëª¨ë“  ë¬¸ì œì  í•´ê²°ë¨
- **ì„±ê³µë¥ **: ì˜ˆìƒ 100% (ì—ëŸ¬ í•´ê²°ë¨)
- **ê°œì„ ì‚¬í•­**:
  - âœ… ë¹„ë™ê¸° ì²˜ë¦¬ ë¬¸ì œ í•´ê²°
  - âœ… ìµœì‹  LangChain API ì ìš© (`create_openai_functions_agent`, `AgentExecutor`)
  - âœ… Deprecated í•¨ìˆ˜ êµì²´ (`.run()` â†’ `.invoke()`)
  - âœ… ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
  - âœ… Function Tool ë™ê¸°í™”

## ğŸ”§ ì£¼ìš” ê°œì„ ì‚¬í•­

### ë¬¸ì œì  í•´ê²°

1. **"Tool does not support sync" ì—ëŸ¬**
   - ì›ì¸: ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ê¸° ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ
   - í•´ê²°: ëª¨ë“  Toolì„ ë™ê¸° ë²„ì „ìœ¼ë¡œ ì¬ì‘ì„±
2. **LangChain API ë²„ì „ ë¬¸ì œ**
   - ì›ì¸: `initialize_agent` deprecated
   - í•´ê²°: `create_openai_functions_agent` + `AgentExecutor` ì‚¬ìš©
3. **í•¨ìˆ˜ í˜¸ì¶œ ë°©ì‹ ë¬¸ì œ**
   - ì›ì¸: `.run()` ë©”ì„œë“œ deprecated
   - í•´ê²°: `.invoke()` ë©”ì„œë“œ ì‚¬ìš©

### ìƒˆë¡œìš´ ê¸°ëŠ¥

- **í–¥ìƒëœ ì—ëŸ¬ ì²˜ë¦¬**: ê° ë‹¨ê³„ë³„ ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€
- **ì„±ëŠ¥ ì¸¡ì •**: ì‹¤í–‰ ì‹œê°„ ë¶„ì„ ë° í†µê³„
- **ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ**: ì‹¤ì œ DB ì—°ê²° ì—†ì´ë„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ê°œì„ ëœ ë¡œê¹…**: ìƒì„¸í•œ ì‹¤í–‰ ê³¼ì • ì¶”ì 